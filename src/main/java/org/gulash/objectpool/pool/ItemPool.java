package org.gulash.objectpool.pool;

import org.gulash.objectpool.pool.util.PoolStatistics;

/**
 * Базовый интерфейс для всех пулов объектов.
 * Паттерн "Object Pool" (Пул объектов) используется для управления жизненным циклом
 * "дорогих" объектов (соединения с БД, потоки, сокеты).
 *
 * Основные цели паттерна:
 * 1. Снижение нагрузки на CPU и память за счет повторного использования объектов.
 * 2. Ускорение работы (не нужно ждать создания нового объекта).
 * 3. Контроль количества созданных ресурсов (ограничение максимального размера).
 */
public interface ItemPool<T> extends AutoCloseable {

    /**
     * Получить объект из пула.
     * Если в пуле есть свободный объект, он возвращается немедленно.
     * Если свободных объектов нет, но лимит не достигнут — создается новый.
     * Если лимит достигнут — поток ожидает освобождения объекта другими потоками.
     *
     * @param timeoutMs максимальное время ожидания в миллисекундах
     * @return объект из пула или null если за указанное время объект не освободился
     * @throws InterruptedException если поток был прерван во время ожидания
     * @throws IllegalStateException если пул уже закрыт
     */
    T acquire(long timeoutMs) throws InterruptedException;

    /**
     * Получить объект из пула с неограниченным временем ожидания.
     * Поток будет заблокирован до тех пор, пока в пуле не появится свободный объект.
     */
    default T acquire() throws InterruptedException {
        return acquire(Long.MAX_VALUE);
    }

    /**
     * Вернуть объект обратно в пул для повторного использования.
     * После вызова этого метода объект становится доступен для других вызовов acquire().
     *
     * @param object объект, который нужно вернуть в пул
     * @throws IllegalArgumentException если объект не принадлежит этому пулу
     */
    void release(T object);

    /**
     * Получить текущую статистику использования пула (количество свободных/занятых объектов и т.д.).
     */
    PoolStatistics getStatistics();

    /**
     * Закрыть пул и корректно освободить все удерживаемые им ресурсы.
     * Все свободные объекты уничтожаются немедленно. Те, что находятся в использовании,
     * будут уничтожены при их возврате в пул (через метод release).
     */
    @Override
    void close();
}
