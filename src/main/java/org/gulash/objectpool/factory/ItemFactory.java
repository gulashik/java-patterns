package org.gulash.objectpool.factory;

import org.gulash.objectpool.pool.ItemPool;

/**
 * Фабрика для управления жизненным циклом объектов внутри пула.
 * Паттерн "Abstract Factory" в связке с "Object Pool" позволяет отделить
 * логику управления пулом от логики создания конкретных объектов.
 *
 * @param <T> тип создаваемого объекта
 */
public interface ItemFactory<T> {

    /**
     * Создать новый экземпляр объекта.
     * Вызывается пулом при его инициализации (minSize) или когда текущих
     * объектов не хватает для обработки запросов (но maxSize еще не достигнут).
     *
     * @param objectPool ссылка на пул, которому принадлежит объект (может быть полезна для self-release)
     */
    T create(ItemPool<T> objectPool);

    /**
     * Проверить состояние объекта перед тем, как отдать его клиенту.
     * Если объект (например, соединение с БД) стал неактивным, пул уничтожит его
     * и попытается создать новый взамен.
     *
     * @param object проверяемый объект
     * @return true - объект годен к использованию, false - объект требует утилизации
     */
    default boolean validate(T object) {
        return true;
    }

    /**
     * Подготовить объект к возврату в пул.
     * Позволяет "очистить" объект от данных предыдущего использования
     * (сбросить флаги, очистить буферы и т.д.), чтобы следующий клиент
     * получил объект в "чистом" состоянии.
     */
    default void reset(T object) {
        // По умолчанию действия не требуются
    }

    /**
     * Окончательно уничтожить объект.
     * Вызывается, когда объект не прошел валидацию или когда пул закрывается.
     * Здесь нужно закрыть реальные системные ресурсы (сокеты, файлы, соединения).
     */
    default void destroy(T object) {
        // По умолчанию действия не требуются
    }
}