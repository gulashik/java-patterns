# Паттерн Посетитель (Visitor)

## Суть паттерна
**Посетитель** — это поведенческий паттерн проектирования, который позволяет добавлять в программу новые операции, не изменяя классы объектов, над которыми эти операции будут выполняться.

Паттерн предлагает вынести новое поведение в отдельный класс, называемый *посетителем*, вместо того чтобы пытаться интегрировать его в уже существующие классы. Объект, над которым должна быть выполнена операция, принимает посетителя в качестве аргумента и передает ему себя, вызывая соответствующий метод.

## Мотивация
Представьте, что у вас есть сложная структура объектов (например, дерево геометрических фигур). Вам нужно добавить функциональность экспорта всей этой структуры в XML. 
Если вы начнете добавлять метод `exportToXML` в каждый класс фигуры, вы нарушите принцип открытости/закрытости (Open/Closed Principle) и загрязните классы, основная задача которых — работа с графикой, логикой сериализации.

Более того, если завтра понадобится экспорт в JSON, вам снова придется менять все классы. Посетитель решает эту проблему, вынося логику экспорта вовне.

## Реализация в примере
- `Shape` — интерфейс элементов с методом `accept`.
- `Dot`, `Circle`, `Rectangle`, `CompoundShape` — конкретные элементы.
- `Visitor` — интерфейс посетителя с методами для каждого типа элемента.
- `XMLExportVisitor` — конкретная реализация, экспортирующая фигуры в XML.

## Когда использовать
- Когда нужно выполнить операцию над всеми элементами сложной структуры (например, деревом объектов).
- Когда над объектами нужно часто выполнять несвязанные между собой операции.
- Когда структура объектов меняется редко, а новые операции добавляются часто.

## Плюсы и минусы
✅ **Плюсы:**
- Объединение родственных операций в одном классе.
- Упрощение классов элементов (SRP).
- Легкое добавление новых операций.
- Посетитель может накапливать состояние при обходе структуры.

❌ **Минусы:**
- Сложно добавлять новые классы элементов (нужно менять интерфейс Visitor и все его реализации).
- Может потребоваться предоставление публичного доступа к полям элементов, которые иначе были бы приватными.

## Best Practices
- Используйте Посетитель только если иерархия элементов стабильна.
- Если методы `visit` возвращают значение (как в нашем примере `Object`), это позволяет удобно собирать результаты обхода.
- Для рекурсивных структур (как `CompoundShape`) посетитель может сам инициировать обход дочерних элементов или делегировать это элементу.
